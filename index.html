<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WALRUS Presale</title>
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#05070d;color:#fff;text-align:center}
    .wrap{max-width:860px;margin:0 auto;padding:26px 16px}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);
      border-radius:18px;padding:18px;margin:16px auto;max-width:720px;text-align:left}
    h1{margin:10px 0 4px;font-size:48px}
    .sub{opacity:.8;margin-bottom:14px}
    .stage{font-size:34px;font-weight:900;color:#1ef7d9;text-align:center;margin:6px 0 12px}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:10px 0}
    .pill{min-width:240px;padding:10px 14px;border-radius:999px;background:rgba(30,247,217,.10);
      border:1px solid rgba(30,247,217,.30);font-weight:900;text-align:center}
    .btn{display:block;margin:14px auto 8px;max-width:520px;width:95%;padding:16px 18px;
      border-radius:16px;background:linear-gradient(#1ef7d9,#71ffe9);color:#041012;
      font-weight:1000;font-size:24px;text-decoration:none}
    .muted{opacity:.65;font-size:13px;text-align:center}
    .box{background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);
      border-radius:14px;padding:12px;font-family:monospace;word-break:break-all}
    .copy{margin-top:10px;padding:10px 12px;border-radius:14px;border:1px solid rgba(30,247,217,.25);
      background:rgba(30,247,217,.12);color:#dffef8;font-weight:900;display:inline-block;cursor:pointer}
    input{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25);color:#fff;font-weight:900;margin-top:10px}
    .result{margin-top:10px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.20);font-weight:900;min-height:48px}
    .links{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .link{padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);color:#fff;text-decoration:none;font-weight:900}
  </style>
</head>

<body>
  <div class="wrap">
    <h1>$WALRUS</h1>
    <div class="sub">Presale â€¢ Built on Solana</div>

    <div class="card">
      <div id="stageTitle" class="stage">Stage 1 Presale</div>

      <div class="row">
        <div class="pill">Stage Price: <span id="stagePrice">$0.0000001</span></div>
        <div class="pill">Raised: <span id="raisedSol">0.00 SOL</span></div>
      </div>

      <div class="row">
        <div class="pill">Next Stage At: <span id="nextStage">1500 SOL</span></div>
      </div>

      <a id="buyBtn" class="btn" href="#">BUY WITH SOL</a>
      <div class="muted">Opens Phantom / Solflare</div>

      <div style="margin-top:14px;font-weight:1000;opacity:.8">Presale Wallet</div>
      <div id="walletBox" class="box"></div>
      <div id="copyBtn" class="copy">ðŸ“‹ Copy Wallet</div>

      <div style="margin-top:16px;font-weight:1000;opacity:.8">Estimate Tokens</div>
      <div class="muted" style="text-align:left">Enter how much SOL you plan to send (uses current stage price).</div>
      <input id="solInput" type="number" step="0.0001" placeholder="SOL amount (example: 1.5)" />
      <div id="estimateOut" class="result">Enter SOL amount above.</div>

      <div class="muted" id="status" style="margin-top:10px">Loadingâ€¦</div>
    </div>

    <div class="links">
      <a class="link" href="https://x.com/walrusmemecoin" target="_blank" rel="noreferrer">@walrusmemecoin</a>
      <a class="link" id="solscanLink" href="#" target="_blank" rel="noreferrer">View Wallet (Solscan)</a>
    </div>
  </div>

  <script>
    // ===== YOUR SETTINGS =====
    const PRESALE_WALLET = "9RHnZobeZBKSLDaTVEiKk5FewZapSTJfyHnR396d7QEi";
    const TOTAL_STAGES = 20;
    const SOL_PER_STAGE = 1500;

    // Stage 1 = 0.0000001, Stage 2 = 0.0000002, ...
    const PRICE_STEP_USD = 0.0000001;

    // Solana RPC
    const RPC_URL = "https://api.mainnet-beta.solana.com";

    // ===== Helpers (safe) =====
    const el = (id) => document.getElementById(id);

    function formatSol(x){
      return (Math.floor(x * 100) / 100).toFixed(2);
    }

    // EXACT display like 0.0000001 / 0.0000002 (no scientific notation)
    function formatUsdTiny(x){
      return "$" + x.toFixed(7);
    }

    function stageFromRaised(sol){
      const s = Math.floor(sol / SOL_PER_STAGE) + 1;
      return Math.max(1, Math.min(TOTAL_STAGES, s));
    }

    function stagePrice(stage){
      return stage * PRICE_STEP_USD;
    }

    function nextThreshold(stage){
      if(stage >= TOTAL_STAGES) return null;
      return stage * SOL_PER_STAGE;
    }

    async function getBalanceSOL(address){
      const body = { jsonrpc:"2.0", id:1, method:"getBalance", params:[address, {commitment:"confirmed"}] };
      const res = await fetch(RPC_URL, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(body) });
      const data = await res.json();
      const lamports = (data && data.result && typeof data.result.value === "number") ? data.result.value : 0;
      return lamports / 1e9;
    }

    function render(raisedSol){
      const st = stageFromRaised(raisedSol);
      const price = stagePrice(st);
      const next = nextThreshold(st);

      el("stageTitle").textContent = `Stage ${st} Presale`;
      el("stagePrice").textContent = formatUsdTiny(price);
      el("raisedSol").textContent = `${formatSol(raisedSol)} SOL`;

      el("nextStage").textContent = (next === null) ? `Final Stage` : `${next} SOL`;

      // Token estimate box uses current stage price
      const input = parseFloat(el("solInput").value || "0");
      if(input > 0){
        const est = input / price; // estimate display only
        el("estimateOut").textContent = `${input.toFixed(4)} SOL â‰ˆ ${Math.floor(est).toLocaleString()} WALRUS (estimate)`;
      }else{
        el("estimateOut").textContent = "Enter SOL amount above.";
      }
    }

    async function refresh(){
      try{
        el("status").textContent = "Updating on-chain dataâ€¦";
        const bal = await getBalanceSOL(PRESALE_WALLET);
        render(bal);
        el("status").textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
      }catch(e){
        // Never blank
        render(0);
        el("status").textContent = "RPC blocked / network issue. Refresh and try again.";
      }
    }

    // ===== Init (never blank) =====
    el("walletBox").textContent = PRESALE_WALLET;
    el("buyBtn").href = `solana:${PRESALE_WALLET}`;
    el("solscanLink").href = `https://solscan.io/account/${PRESALE_WALLET}`;

    el("copyBtn").onclick = async () => {
      try{
        await navigator.clipboard.writeText(PRESALE_WALLET);
        el("copyBtn").textContent = "âœ… Copied!";
        setTimeout(()=> el("copyBtn").textContent = "ðŸ“‹ Copy Wallet", 1200);
      }catch(e){
        window.prompt("Copy wallet:", PRESALE_WALLET);
      }
    };

    el("solInput").addEventListener("input", async () => {
      // Re-render using last known stage price (without refetching)
      // Simple: just call refresh when they type (light)
      refresh();
    });

    render(0);
    refresh();
    setInterval(refresh, 20000);
  </script>
</body>
</html>
